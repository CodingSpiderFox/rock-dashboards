filter {
  if [@metadata][stage] == "suricata_json" {
    if [dns] {

      #json {
      #    source => "[dns][answers]"
      #    target => "temp_answers"
      #    remove_field => "answers"
      #  #rename => {
      #  #  "[dns][answers][rrname]" => "[dns][question][name]"
      #  #  "[dns][answers][rrtype]" => "[dns][question][type]"
      #  #  "[dns][answers][rdata]" => "[dns][answers][name]"
      #  #}
      #}
      #ruby {
      #  code => "event.get('temp_answers').each { |kv| event.set(kv['rrname'], kv['rrtype'], kv['rdata']) }"
      #}
      mutate { rename => { "[dns][answers]" => "[suricata][dns][answers]" } }
      mutate { rename => { "[dns][authorities]" => "[suricata][dns][authorities]" } }

      mutate {
        rename => {
          "[dns][rcode]" => "[dns][response_code]"
          "[dns][rrname]" => "[dns][question][name]"
          "[dns][rrtype]" => "[dns][question][type]"
          "[dns][rdata]" => "[dns][answers][name]"
        }
      }

    }
  }
}
